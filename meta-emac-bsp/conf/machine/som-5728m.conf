#@TYPE: Machine
#@NAME: SoM-5728M
#@DESCRIPTION: Machine configuration for the SoM-5728M

MACHINEOVERRIDES =. "dra7xx-evm:"
include conf/machine/dra7xx-evm.conf

KERNEL_DEVICETREE_PREFIX = " emac-som-5728m"
KERNEL_DEVICETREE = "emac-som-5728m-350es.dtb"

UBOOT_MACHINE = "emac-som-5728m_config"

MACHINE_FEATURES:append = " serial ext3 ext4 can i2c spi wifi bluetooth"

PREFERRED_PROVIDER_virtual/gpudriver = "ti-sgx-ddk-km"

# Taken from meta-arago
# Prefer OpenSSL over GnuTLS for curl due to TSU exemptions
PACKAGECONFIG:pn-curl = "${@bb.utils.contains("DISTRO_FEATURES", "ipv6", "ipv6", "", d)} proxy openssl verbose zlib"
PACKAGECONFIG:pn-glmark2 = "drm-gles2 wayland-gles2"
# Enable encryption support in open62541
PACKAGECONFIG:append:pn-open62541 = " encrypt"
# Enable netperf intervals/pacing and histogram
PACKAGECONFIG:append:pn-netperf = " intervals histogram"
# Use OpenGL ES2 for SDL2
PACKAGECONFIG_GL:pn-libsdl2 = "gles2"
# Add KMS/DRM backend support
PACKAGECONFIG:append:pn-libsdl2 = " kmsdrm"
# Enable cryptodev/devcrypto engine in OpenSSL 1.1
PACKAGECONFIG:append:pn-openssl = " cryptodev-linux"
# Enable GST_TRACER logging in gstreamer
PACKAGECONFIG:append:pn-gstreamer1.0 = " tracer-hooks"
# Enable EGL/GLESv2 support on non-x11
PACKAGECONFIG:append:pn-cairo = " egl ${@bb.utils.contains("DISTRO_FEATURES", "x11", "", "glesv2", d)}"

IMAGE_INSTALL:append = " \
    i2c-tools \
    spidev-test \
    kernel-modules \
    alsa-utils-aplay \
    ethtool \
    packagegroup-ti-connectivity \
"

PREFERRED_PROVIDER_wpa-supplicant:omap-a15 = "wpa-supplicant-wl18xx"