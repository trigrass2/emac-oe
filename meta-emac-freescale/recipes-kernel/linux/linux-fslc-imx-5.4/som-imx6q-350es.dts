/*
 * Copyright 2022 EMAC Inc.
 * Copyright 2016 EMAC Inc.
 * Copyright 2016 QWERTY Embedded Design
 *
 * Author: Joseph Mills <jmills@emacinc.com>
 * Author: Michael Welling <mwelling@ieee.org>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 *
 */



#include "imx6q.dtsi"
#include "som-imx6dq.dtsi"
#include <dt-bindings/interrupt-controller/irq.h>
#include <dt-bindings/sound/fsl-imx-audmux.h>

&iomuxc {
    imx6qdl-350es {
        pinctrl_wifi: wifigrp {
            fsl,pins = <
                MX6QDL_PAD_NANDF_CS3__GPIO6_IO16   	0x13059		/* WL_IRQ */
                MX6QDL_PAD_DISP0_DAT11__GPIO5_IO05 	0x13059		/* WL_EN */
            >;
        };
        pinctrl_bt: btgrp {
            fsl,pins = <
                MX6QDL_PAD_DISP0_DAT12__GPIO5_IO06	0x13059		/* BT_EN */
            >;
        };
        pinctrl_tsc: tscgrp {
            fsl,pins = <
                MX6QDL_PAD_ENET_RXD0__GPIO1_IO27	0x1b0b0
            >;
        };
    };
};


/ {
    model = "EMAC SOM-iMX6M (imx6q)";
    compatible = "emac,som-imx6q-350es", "fsl,imx6q";
    chosen {
        stdout-path = &uart2;
    };
    memory {
        device_type = "memory";
        reg = <0x10000000 0x80000000>;
    };
    
    aliases {
        ts_tsc2004 = &ts_tsc2004;
        backlight_gpio = &backlight_gpio;
        lvds_3p3v = &lvds_3p3v;
        backlight_pwm = &backlight_pwm;
        bl_pwr = &bl_pwr;
    };
    
    clocks{
        tlv320_mclk: tlv320_mclk {
            #clock-cells = <0>;
            compatible = "fixed-clock";
            clock-frequency = <12000000>;
            clock-output-names = "mclk";
        };
    };
    
    regulators {
        reg_wl18xx_vmmc: regulator-wl18xx {
            compatible = "regulator-fixed";
            regulator-name = "wlan-en-regulator";
            regulator-min-microvolt = <1800000>;
            regulator-max-microvolt = <1800000>;
            gpio = <&gpio5 5 GPIO_ACTIVE_HIGH>;
            enable-active-high;
            startup-delay-us = <70000>;
        };
        
        lvds_3p3v: lvds_3p3v_reg {
            compatible = "regulator-fixed";
            regulator-name = "LVDS 3P3V";
            regulator-min-microvolt = <3300000>;
            regulator-max-microvolt = <3300000>;
            regulator-always-on;
            enable-active-high;
            gpio = <&gpio1 29 GPIO_ACTIVE_HIGH>;
        };

        bl_pwr: bl_pwr_reg {
            compatible = "regulator-fixed";
            reg = <5>;
            regulator-name = "LVDS ABL";
            regulator-min-microvolt = <3300000>;
            regulator-max-microvolt = <3300000>;
            regulator-always-on;
            gpio = <&gpio1 30 GPIO_ACTIVE_LOW>;
        };
    };
    //reg
    
    backlight_gpio: backlight_gpio {
        compatible = "gpio-backlight";
        gpios = <&gpio1 30 GPIO_ACTIVE_HIGH>;
        default-on;
        display = <&mxcfb1>;
    };
    
    backlight_pwm: backlight_pwm {
        compatible = "pwm-backlight";
        pwms = <&pwm1 0 50000 0>;
        enable-gpios = <&gpio5 7 GPIO_ACTIVE_HIGH>;
        power-supply = <&bl_pwr>;
        brightness-levels = <0 10 20 30 40 50 60 70 80 90 100>;
        default-brightness-level = <9>;
        display = <&mxcfb1>; 
    };
    
    beeper: beeper {
        compatible = "gpio-beeper";
        gpios = <&gpio5 8 GPIO_ACTIVE_HIGH>;
    };
    
    #if 0 
  FIXME make this as fsl audio. 
  	sound {
		compatible = "fsl,imx-audio-aic32x4";
		model = "tlv320aic32x4";
		ssi-controller = <&ssi1>;
		audio-codec = <&codec>;
		audio-routing =
            "Line Out Jack", "LOL" 
            "Line Out Jack", "LOR" 
            "Headphone Jack", "HPL",
			"Headphone Jack", "HPR";
		mux-int-port = <1>;
		mux-ext-port = <4>;
	};
#endif
    sound {
		compatible = "simple-audio-card";
		simple-audio-card,format = "i2s";
		simple-audio-card,name = "tlv320aic32x4";
		simple-audio-card,bitclock-master = <&codec_master>;
		simple-audio-card,frame-master = <&codec_master>;
		simple-audio-card,widgets =
			"Microphone", "Microphone Jack",
			"Headphone", "Headphone Jack";
		simple-audio-card,routing =
			"Headphone Jack", "HPL",
			"Headphone Jack", "HPR",
			"IN1_L", "Microphone Jack",
			"IN1_R", "Microphone Jack",
			"Microphone Jack", "Mic Bias";

		cpu_master: simple-audio-card,cpu {
			sound-dai = <&ssi1>;
		};

		codec_master: simple-audio-card,codec {
			sound-dai = <&codec>;
			clocks = <&tlv320_mclk>;
		};
	};
};

&i2c1 {  
    eeprom@50 {
        compatible = "st,24c32";
        reg = <0x50>;
        pagesize = <32>;
    };
};
&i2c2 {
    codec: tlv320aic32x4@18{
        #sound-dai-cells = <0>;
        compatible = "ti,tlv320aic32x4";
        reg = <0x18>;
        clocks = <&tlv320_mclk>;
        clock-names = "mclk";
        iov-supply = <&reg_3p3v>;
        ldoin-supply = <&reg_3p3v>;
        input-use = <1 1 0 0 0 0>;
        cmode = <0x11 0>;
        status = "okay";
    };
};
&i2c3 {
    ts_tsc2004: touchscreen@48 {
        compatible = "ti,tsc2004";
        interrupts-extended = <&gpio1 27 IRQ_TYPE_EDGE_RISING>;
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_tsc>;
        reg = <0x48>;
        status = "okay";
        vio-supply = <&reg_3p3v>;
        touchscreen-size-x = <4096>;
        touchscreen-size-y = <4096>;
        touchscreen-max-pressure = <2048>;
        touchscreen-fuzz-x = <4>;
        touchscreen-fuzz-y = <7>;
        touchscreen-fuzz-pressure = <2>;
        ti,x-plate-ohms = <850>;
        ti,esd-recovery-timeout-ms = <800>;
    };
};

&ecspi1 {
    spidev1: spi@1 {
        compatible = "emac,spidev";
        reg = <1>;
        spi-max-frequency = <1000000>;
    };

    spidev2: spi@2 {
        compatible = "emac,spidev";
        reg = <2>;
        spi-max-frequency = <1000000>;
    };

    spidev3: spi@3 {
        compatible = "emac,spidev";
        reg = <3>;
        spi-max-frequency = <1000000>;
    };
};
&ecspi3 {
    spidev4: spi@1 {
        compatible = "emac,spidev";
        reg = <1>;
        spi-max-frequency = <20000000>;
    };

    spidev5: spi@2 {
        compatible = "emac,spidev";
        reg = <2>;
        spi-max-frequency = <20000000>;
    };

    spidev6: spi@3 {
        compatible = "emac,spidev";
        reg = <3>;
        spi-max-frequency = <20000000>;
    };
};

&pcie{
    status = "okay";
};

&sata{
    status = "okay";
};

&usdhc2 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_usdhc2>;
    vmmc-supply = <&reg_3p3v>;
    cd-gpios = <&gpio1 4 GPIO_ACTIVE_LOW>;
    disable-wp;
    status = "okay";
};


&usdhc3 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_usdhc3>;
    non-removable;
    no-1-8-v;
    sd-uhs-sdr50;
    bus-width = <4>;
    status = "okay";
};


&usdhc4 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_usdhc4 &pinctrl_wifi>;
    bus-width = <4>;
    vmmc-supply = <&reg_wl18xx_vmmc>;
    non-removable;
    wakeup-source;
    keep-power-in-suspend;
    cap-power-off-card;
#if 0
    TODO add the pin group for both 200mhz and 400mhz 
    pinctrl-names = "default", "state_100mhz", "state_200mhz";
	pinctrl-1 = <&pinctrl_usdhc4_100mhz>;
    pinctrl-2 = <&pinctrl_usdhc4_200mhz>;
    enable-sdio-wakeup;
#endif

    #address-cells = <1>;
    #size-cells = <0>;

    status = "okay";
    wlcore: wlcore@0 {
            compatible = "ti,wl1835";
            reg = <2>;
            interrupt-parent = <&gpio6>;
            interrupts = <16 IRQ_TYPE_LEVEL_HIGH>;
            ref-clock-frequency = <38400000>;
    };
};

&pwm1 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_pwm1>;
    #pwm-cells = <3>;
    status = "okay";
};

&pwm2 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_pwm2>;
    #pwm-cells = <3>;
    status = "okay";
};

&pwm3 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_pwm3>;
    #pwm-cells = <3>;
    status = "okay";
};

&pwm4 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_pwm4>;
    #pwm-cells = <3>;
    status = "okay";
};

&audmux {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_audmux>;
    status = "okay";

    ssi1 {
        fsl,audmux-port = <0>;
        fsl,port-config = <
            (IMX_AUDMUX_V2_PTCR_SYN |
            IMX_AUDMUX_V2_PTCR_TFSEL(3) |
            IMX_AUDMUX_V2_PTCR_TCSEL(3) |
            IMX_AUDMUX_V2_PTCR_TFSDIR |
            IMX_AUDMUX_V2_PTCR_TCLKDIR)
            IMX_AUDMUX_V2_PDCR_RXDSEL(3)
        >;
    };

    pins5 {
        fsl,audmux-port = <3>;
        fsl,port-config = <
            IMX_AUDMUX_V2_PTCR_SYN
            IMX_AUDMUX_V2_PDCR_RXDSEL(0)
        >;
    };
};
